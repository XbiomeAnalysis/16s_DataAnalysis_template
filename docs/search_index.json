[["index.html", "16s microbiota data analysis based on XMAS package Chapter 1 Prerequisites 1.1 Preparing for the tutorial 1.2 Workflow description", " 16s microbiota data analysis based on XMAS package Hua Zou 2022-06-01 Chapter 1 Prerequisites Here, we give users one example to practice the 16s microbiota data analysis workflow by XMAS 2.0. By the way, we also recommend users handling your own microbiota data in a reasonable manner when you utilize this package or workflow. Pay attention to whether your data fit the methods this package provided. 1.1 Preparing for the tutorial This tutorial requires that the users should have basic knowledge on R language and statistics. If you are new to microbial research, we recommend the Statistical Analysis of Microbiome Data with R (Xia et al. 2018) as guide book. We suggest users using local laptop because our own server have not deployed XMAS 2.0 package yet. In addition, installing the following software before using XMAS 2.0. R 3.6.3 or later release Download link. Rstudio Desktop Download link. 1.2 Workflow description The standard data analysis of 16S and MGS data by XMAS 2.0. The upstream process is performed by in-house pipeline. and this example just shows how to perform downstream data analysis. In briefly, the example comprises the following steps: Converting inputs into phyloseq object; Quality Evaluation; Pre-Processing Data; Diversity analysis; Ordination analysis; Composition analysis; Differential analysis. Figure 1.1: Functions of XMAS 2.0 References "],["convert-inputdata-into-phyloseq-object.html", "Chapter 2 Convert inputdata into phyloseq object 2.1 DADA2 2.2 Summarize phyloseq-class object 2.3 Systematic Information", " Chapter 2 Convert inputdata into phyloseq object r Biocpkg(“phyloseq”) (McMurdie and Holmes 2013) is the most popular Biocondcutor package used by the microbiome research field, and phyloseq-class objects are a great data-standard for microbiota data in R. Therefore, the core functions in XMAS take phyloseq-class object as input. In the phyloseq object, information on OTU abundances, taxonomy of OTUs, the phylogenetic tree and metadata is stored. This tutorial will introduce you the basic steps to convert results from the in-house pipeline into phyloseq-class object. More importantly on how to look at your data and filter appropriately. We will use the inputs from /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/. Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) 2.1 DADA2 dada2 results from standardized_analytics_workflow_R_function 2.1.1 Importing results from dada2 pipeline /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/16S/process/xdada2/dada2_res.rds /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/16S/process/fasta2tree/tree.nwk /home/xuxiaomin/project/standardized_analytics_workflow_R_function/demo_data/16S/metadata.txt dada2_res &lt;- readRDS( system.file( &quot;extdata&quot;, &quot;dada2_res.rds&quot;, package = &quot;XMAS2&quot; ) ) sam_tab &lt;- read.table( system.file( &quot;extdata&quot;, &quot;dada2_metadata.tsv&quot;, package = &quot;XMAS2&quot; ), sep = &quot;\\t&quot;, header = TRUE, stringsAsFactors = FALSE ) tree &lt;- read_tree( system.file( &quot;extdata&quot;, &quot;tree.nwk&quot;, package = &quot;XMAS2&quot; ) ) 2.1.2 taxa table We use import_dada2_taxa to convert dada2_res$tax_tab into our own taxa table tax_tab &lt;- import_dada2_taxa(dada2_res$tax_tab) head(tax_tab, 1) ## Kingdom ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG k__Bacteria ## Phylum ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG p__Firmicutes ## Class ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG c__Clostridia ## Order ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG o__Clostridiales ## Family ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG f__Lachnospiraceae ## Genus ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG g__Blautia ## Species ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG s__Blautia_unclassified 2.1.3 otu table otu_tab &lt;- dada2_res$seq_tab # Shouldn&#39;t use the Total Number as SampleID (wrong: 123456; right: X123456) rownames(otu_tab) &lt;- paste0(&quot;S&quot;, rownames(otu_tab)) head(otu_tab[, 1, F]) ## TAATACGTAGGGGGCAAGCGTTATCCGGATTTACTGGGTGTAAAGGGAGCGTAGACGGTGTGGCAAGTCTGATGTGAAAGGCATGGGCTCAACCTGTGGACTGCATTGGAAACTGTCATACTTGAGTGCCGGAGGGGTAAGCGGAATTCCTAGTGTAGCGGTGAAATGCGTAGATATTAGGAGGAACACCAGTGGCGAAGGCGGCTTACTGGACGGTAACTGACGTTGAGGCTCGAAAGCGTGGGGAGCAAACAGG ## S6030 1253 ## S6032 14677 ## S6033 2929 ## S6035 0 ## S6036 3548 ## S6037 8484 2.1.4 metadata table sam_tab &lt;- sam_tab %&gt;% tibble::column_to_rownames(&quot;seqID&quot;) # Shouldn&#39;t use the Total Number as SampleID (wrong: 123456; right: X123456) rownames(sam_tab) &lt;- paste0(&quot;S&quot;, rownames(sam_tab)) head(sam_tab) ## Group ## S6065 AA ## S6049 AA ## S6043 AA ## S6037 AA ## S6059 AA ## S6060 AA 2.1.5 phyloseq object dada2_ps &lt;- get_dada2_phyloseq(seq_tab = otu_tab, tax_tab = tax_tab, sam_tab = sam_tab, phy_tree = tree) dada2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 896 taxa and 24 samples ] ## sample_data() Sample Data: [ 24 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 896 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 896 tips and 893 internal nodes ] ## refseq() DNAStringSet: [ 896 reference sequences ] we obtain the phyloseq-class object and then use it to perform data analysis. Here, the phyloseq object comprises five components (OTU Table, Sample Data, Taxonomy Table, Phylogenetic Tree and DNAStringSet). otu_table dada2_ps@otu_table %&gt;% data.frame() %&gt;% head() ## S6030 S6032 S6033 S6035 S6036 S6037 S6040 S6043 S6045 S6046 S6048 S6049 S6050 S6054 S6055 S6058 S6059 S6060 S6061 S6063 S6065 ## ASV_1 1253 14677 2929 0 3548 8484 11727 5218 4942 7347 3503 3803 14593 4275 2812 0 6847 17893 2956 3328 6302 ## ASV_2 2810 1558 1839 11885 0 5632 631 7326 1809 4781 3476 108 3100 39 3879 6389 298 4995 196 45061 542 ## ASV_3 7107 2915 2200 0 1232 19675 0 1617 839 9362 4815 0 0 1121 13472 0 1421 0 0 0 9694 ## ASV_4 0 2280 94 13775 0 4456 937 746 3730 273 85 64 562 448 18 611 96 5976 0 837 0 ## ASV_5 6983 15963 1172 256 12140 874 1722 120 210 0 111 802 994 1971 18 517 808 443 48 109 7 ## ASV_6 489 0 199 0 836 0 8565 0 0 1257 0 5998 0 3093 2091 0 10572 0 8495 0 2703 ## S6066 S6068 S8005 ## ASV_1 8414 0 0 ## ASV_2 357 10870 7325 ## ASV_3 4387 0 14797 ## ASV_4 706 17977 0 ## ASV_5 122 546 2516 ## ASV_6 0 0 974 tax_table dada2_ps@tax_table %&gt;% data.frame() %&gt;% head() ## Kingdom Phylum Class Order Family Genus ## ASV_1 k__Bacteria p__Firmicutes c__Clostridia o__Clostridiales f__Lachnospiraceae g__Blautia ## ASV_2 k__Bacteria p__Actinobacteria c__Actinobacteria o__Bifidobacteriales f__Bifidobacteriaceae g__Bifidobacterium ## ASV_3 k__Bacteria p__Actinobacteria c__Actinobacteria o__Bifidobacteriales f__Bifidobacteriaceae g__Bifidobacterium ## ASV_4 k__Bacteria p__Firmicutes c__Clostridia o__Clostridiales f__Lachnospiraceae g__Lachnospiraceae_unclassified ## ASV_5 k__Bacteria p__Firmicutes c__Bacilli o__Lactobacillales f__Streptococcaceae g__Streptococcus ## ASV_6 k__Bacteria p__Firmicutes c__Clostridia o__Clostridiales f__Ruminococcaceae g__Faecalibacterium ## Species ## ASV_1 s__Blautia_unclassified ## ASV_2 s__Bifidobacterium_unclassified ## ASV_3 s__Bifidobacterium_unclassified ## ASV_4 s__Lachnospiraceae_unclassified ## ASV_5 s__Streptococcus_unclassified ## ASV_6 s__Faecalibacterium_unclassified sample_table dada2_ps@sam_data %&gt;% data.frame() %&gt;% head() ## Group ## S6030 BB ## S6032 BB ## S6033 BB ## S6035 AA ## S6036 BB ## S6037 AA 2.2 Summarize phyloseq-class object summarize_phyloseq(dada2_ps) ## Compositional = NO2 ## 1] Min. number of reads = 511812] Max. number of reads = 936223] Total number of reads = 15025374] Average number of reads = 62605.70833333335] Median number of reads = 619157] Sparsity = 0.8653738839285716] Any OTU sum to 1 or less? NO8] Number of singletons = 09] Percent of OTUs that are singletons ## (i.e. exactly one read detected across all samples)010] Number of sample variables are: 1Group2 ## [[1]] ## [1] &quot;1] Min. number of reads = 51181&quot; ## ## [[2]] ## [1] &quot;2] Max. number of reads = 93622&quot; ## ## [[3]] ## [1] &quot;3] Total number of reads = 1502537&quot; ## ## [[4]] ## [1] &quot;4] Average number of reads = 62605.7083333333&quot; ## ## [[5]] ## [1] &quot;5] Median number of reads = 61915&quot; ## ## [[6]] ## [1] &quot;7] Sparsity = 0.865373883928571&quot; ## ## [[7]] ## [1] &quot;6] Any OTU sum to 1 or less? NO&quot; ## ## [[8]] ## [1] &quot;8] Number of singletons = 0&quot; ## ## [[9]] ## [1] &quot;9] Percent of OTUs that are singletons\\n (i.e. exactly one read detected across all samples)0&quot; ## ## [[10]] ## [1] &quot;10] Number of sample variables are: 1&quot; ## ## [[11]] ## [1] &quot;Group&quot; The minus account of the OTU counts is 51181 in the phyloseq object, and we can use it as the threshold to rarefy. Notice the Sparsity (0.865), indicating the data has many zeros and pay attention to the downstream data analysis. A common property of amplicon based microbiota data generated by sequencing. 2.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 References "],["quality-control.html", "Chapter 3 Quality Control 3.1 Reads’ track by DADA2 3.2 Spike-in sample (BRS) assessment 3.3 Spike-in sample’s (BRS) remove 3.4 Rarefaction curves 3.5 Summarize phyloseq-class object 3.6 Systematic Information", " Chapter 3 Quality Control Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) Quality control of DADA2 results will help us have more rational determinations on the further data analysis. 3.1 Reads’ track by DADA2 plot_Dada2Track(data=dada2_res$reads_track) Figure 3.1: Reads’ track by DADA2 The percentage of the final remained read counts approximate 70%, indicating that we should consider the sequence depth for analysis when we build the sequence library. 3.2 Spike-in sample (BRS) assessment The taxonomic levels of spike-in sample’s bacteria is genus. Firstly, using the summarize_taxa to get the genus level phyloseq object and get the BRS_ID. dada2_ps_genus &lt;- summarize_taxa(dada2_ps, taxa_level = &quot;Genus&quot;) dada2_ps_genus@sam_data ## Group ## S6030 BB ## S6032 BB ## S6033 BB ## S6035 AA ## S6036 BB ## S6037 AA ## S6040 BB ## S6043 AA ## S6045 BB ## S6046 BB ## S6048 BB ## S6049 AA ## S6050 BB ## S6054 BB ## S6055 BB ## S6058 BB ## S6059 AA ## S6060 AA ## S6061 AA ## S6063 BB ## S6065 AA ## S6066 AA ## S6068 BB ## S8005 QC do run_RefCheck under the optimal parameters. BRS_ID: the ID of BRS sample; Reference: the directory of the latest spike-in sample matrix (default: /share/projects/Analytics/analytics/XMAS/RefCheck/); Save: the directory to save the latest spike-in sample matrix (default: /share/projects/Analytics/analytics/XMAS/RefCheck/). To see more details to use ?run_RefCheck. run_RefCheck( ps=dada2_ps_genus, BRS_ID=&quot;S8005&quot;, Reference=NULL, Ref_type=&quot;16s&quot;, Save=NULL) ## Noting: the Reference Matrix is for 16s ## S8005 is in the Reference Matrix&#39;s samples and remove it to run ## ## #########Matched baterica of the Spike-in sample########### ## Checking out all the taxa of the Reference Matrix are in the sequencing dataset ## g__Bifidobacterium ## g__Bacteroides ## g__Faecalibacterium ## g__Lactobacillus ## g__Parabacteroides ## g__Collinsella ## g__Coprococcus_3 ## g__Dorea ## g__Streptococcus ## g__Roseburia ## g__Anaerostipes ## g__Escherichia/Shigella ## g__Enterococcus ## g__Prevotella_9 ## g__Eggerthella ## ## The number of the additional Taxa in the sequencing dataset is 1 ## ########################################################### ## ## ##############Value of the Reference sample############### ## Correlation Coefficient of the Reference sample is: 0.9714 ## Bray Curtis of the Reference sample is: 0.07607 ## Impurity of the Reference sample is: 0.06409 ## ########################################################### ## #####Final Evaluation Results of the Spike-in sample####### ## The spike-in sample of sequencing dataset passed the cutoff of the Reference Matrix ## Cutoff of Coefficient is 0.8946 ## Cutoff of BrayCurtis is 0.3878 ## Cutoff of Impurity is 0.1565 ## ########################################################### ## 8002 8003 8004 8006 8007 8008 8009 8005 mean ## Bifidobacterium 31.11079015 30.88310969 32.31232692 18.4930259 20.20409870 17.96225391 18.03588291 27.22437034 24.52823232 ## Bacteroides 20.44753484 14.46581958 24.57151411 26.7370147 25.85863655 27.51353663 26.99272343 24.23896093 23.85321759 ## Faecalibacterium 0.79850615 0.62937893 1.05531023 1.7487249 1.64282727 1.96346413 1.81219797 1.04035376 1.33634542 ## Lactobacillus 2.61732573 3.36856272 3.44379163 5.9292703 5.78000836 5.78189064 6.32672332 3.87088505 4.63980722 ## Parabacteroides 7.11124408 7.45952579 5.36075144 8.7149995 8.01840234 8.74899584 8.62634005 5.61833757 7.45732457 ## Collinsella 0.12792605 0.88271385 0.55665744 1.2764130 0.67921372 1.89356397 1.26367828 0.45502126 0.89189845 ## Coprococcus_3 1.00380683 0.97969362 0.80270938 1.6693557 1.56419908 1.67969035 1.71221463 0.87586251 1.28594151 ## Dorea 2.80715148 3.45564660 2.46613277 3.9684605 3.99163530 3.81529666 3.69382881 2.34880690 3.31836988 ## Streptococcus 2.91960260 3.43387563 2.59149764 3.4818362 3.31409452 3.51378702 3.37721491 2.68740253 3.16491388 ## Roseburia 0.03404484 0.04750030 0.02806676 0.0338295 0.03178586 0.02503886 0.02499583 0.03311188 0.03229673 ## Anaerostipes 0.32291011 0.43245062 0.31528329 0.5386697 0.44500209 0.53416240 0.48047548 0.32471000 0.42420796 ## Escherichia/Shigella 15.27581475 16.00265210 12.36527954 10.8423545 13.43203680 10.15743185 11.59945565 14.03516268 12.96377349 ## Enterococcus 14.51444842 14.66472707 11.04239952 13.1674820 12.07360937 12.88771113 12.84924735 11.61906390 12.85233610 ## Prevotella_9 0.77374627 3.07465463 2.75709154 2.9145415 2.52446675 3.04952478 2.84952508 5.40257632 2.91826586 ## Eggerthella 0.04951976 0.15437596 0.27131203 0.4840221 0.43998327 0.47365181 0.35549631 0.16128688 0.29870601 ## Impurity_level 0.08562792 0.06531291 0.05987576 0.0000000 0.00000000 0.00000000 0.00000000 0.06409000 0.03436332 3.3 Spike-in sample’s (BRS) remove After evaluating the sequencing quality, we remove the BRS. dada2_ps_remove_BRS &lt;- get_GroupPhyloseq( ps = dada2_ps, group = &quot;Group&quot;, group_names = &quot;QC&quot;) dada2_ps_remove_BRS ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 896 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 896 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 896 tips and 893 internal nodes ] ## refseq() DNAStringSet: [ 896 reference sequences ] 3.4 Rarefaction curves plot_RarefCurve(ps = dada2_ps_remove_BRS, taxa_level = &quot;OTU&quot;, step = 100, label = &quot;Group&quot;, color = &quot;Group&quot;) ## rarefying sample S6030 ## rarefying sample S6032 ## rarefying sample S6033 ## rarefying sample S6035 ## rarefying sample S6036 ## rarefying sample S6037 ## rarefying sample S6040 ## rarefying sample S6043 ## rarefying sample S6045 ## rarefying sample S6046 ## rarefying sample S6048 ## rarefying sample S6049 ## rarefying sample S6050 ## rarefying sample S6054 ## rarefying sample S6055 ## rarefying sample S6058 ## rarefying sample S6059 ## rarefying sample S6060 ## rarefying sample S6061 ## rarefying sample S6063 ## rarefying sample S6065 ## rarefying sample S6066 ## rarefying sample S6068 Figure 3.2: Rarefaction curves The result showed that all the samples had different sequence depth but had the full sample richness. 3.5 Summarize phyloseq-class object Summarizing the phyloseq-class object by using summarize_phyloseq. It displayed that briefly introduction of the object. summarize_phyloseq(dada2_ps_remove_BRS) ## Compositional = NO2 ## 1] Min. number of reads = 511812] Max. number of reads = 716673] Total number of reads = 14089154] Average number of reads = 61257.17391304355] Median number of reads = 614357] Sparsity = 0.8610248447204976] Any OTU sum to 1 or less? YES8] Number of singletons = 49] Percent of OTUs that are singletons ## (i.e. exactly one read detected across all samples)010] Number of sample variables are: 1Group2 ## [[1]] ## [1] &quot;1] Min. number of reads = 51181&quot; ## ## [[2]] ## [1] &quot;2] Max. number of reads = 71667&quot; ## ## [[3]] ## [1] &quot;3] Total number of reads = 1408915&quot; ## ## [[4]] ## [1] &quot;4] Average number of reads = 61257.1739130435&quot; ## ## [[5]] ## [1] &quot;5] Median number of reads = 61435&quot; ## ## [[6]] ## [1] &quot;7] Sparsity = 0.861024844720497&quot; ## ## [[7]] ## [1] &quot;6] Any OTU sum to 1 or less? YES&quot; ## ## [[8]] ## [1] &quot;8] Number of singletons = 4&quot; ## ## [[9]] ## [1] &quot;9] Percent of OTUs that are singletons\\n (i.e. exactly one read detected across all samples)0&quot; ## ## [[10]] ## [1] &quot;10] Number of sample variables are: 1&quot; ## ## [[11]] ## [1] &quot;Group&quot; The minus account of the OTU counts is 51181 in the phyloseq object, and we can use it as the threshold to rarefy. Notice the Sparsity (0.86), indicating the data has many zeros and pay attention to the downstream data analysis. A common property of amplicon based microbiota data generated by sequencing. 3.6 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 "],["data-processing.html", "Chapter 4 Data processing 4.1 Rarefy otu counts 4.2 Extracting specific taxonomic level 4.3 Systematic Information", " Chapter 4 Data processing Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) This part has too may procedures and we only choose some of them. Please go to XMAS tutorial: Chapter 6 to see more approaches and details for being familiar with this part. 4.1 Rarefy otu counts From previous results of quality evaluation, the sequence depth of samples are different which have effects on the downstream analysis. Here, choosing the rarefy (Normaliztion method: random subsampling counts to the smallest library size) to get the equal sample sums. dada2_ps_rare &lt;- norm_rarefy(dada2_ps_remove_BRS, size = 51181, rng_seed = 123) dada2_ps_rare ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 891 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 891 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 891 tips and 888 internal nodes ] ## refseq() DNAStringSet: [ 891 reference sequences ] In addition, we could also perform some other normalization methods on the rarefied phyloseq object. By the way, we didn’t transform the data by using log algorithm because the count matrix is required by the following data analysis methods. 4.2 Extracting specific taxonomic level dada2_ps_rare_genus &lt;- summarize_taxa(dada2_ps_rare, taxa_level = &quot;Genus&quot;) dada2_ps_rare_genus ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 198 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 198 taxa by 6 taxonomic ranks ] 4.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 "],["diversity-analysis.html", "Chapter 5 Diversity analysis 5.1 Alpha diveristy 5.2 Beta diversity 5.3 Systematic Information", " Chapter 5 Diversity analysis Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) 5.1 Alpha diveristy Calculate the alpha diversity Notes: the otu table must be counts matrix (rarefied but not trim counts matrix) when you choose Observed etc measures. dada_ps_rare_genus_alpha &lt;- run_alpha_diversity(ps=dada2_ps_rare_genus, measures = c(&quot;Shannon&quot;, &quot;Chao1&quot;, &quot;Observed&quot;)) print(dada_ps_rare_genus_alpha) ## SampleID Group Observed Chao1 se.chao1 Shannon ## 1 S6030 BB 74 74.00000 0.0000000 2.622800 ## 2 S6032 BB 38 38.00000 0.0000000 1.711068 ## 3 S6033 BB 80 80.16667 0.5431879 2.719495 ## 4 S6035 AA 35 35.00000 0.1232013 1.953807 ## 5 S6036 BB 95 95.00000 0.0000000 2.942657 ## 6 S6037 AA 35 35.00000 0.0000000 1.933007 ## 7 S6040 BB 58 58.00000 0.0000000 2.490198 ## 8 S6043 AA 65 65.33333 0.9246628 2.098003 ## 9 S6045 BB 60 60.00000 0.0000000 2.920363 ## 10 S6046 BB 71 71.00000 0.1241166 2.264433 ## 11 S6048 BB 66 66.00000 0.0000000 2.630421 ## 12 S6049 AA 60 60.00000 0.0000000 2.506885 ## 13 S6050 BB 53 53.00000 0.0000000 2.431334 ## 14 S6054 BB 84 84.00000 0.0000000 2.769973 ## 15 S6055 BB 75 75.00000 0.0000000 2.297388 ## 16 S6058 BB 37 37.00000 0.2465985 2.262059 ## 17 S6059 AA 71 71.00000 0.0000000 2.682960 ## 18 S6060 AA 48 48.00000 0.0000000 1.883809 ## 19 S6061 AA 80 80.00000 0.0000000 3.088651 ## 20 S6063 BB 38 38.00000 0.0000000 1.543267 ## 21 S6065 AA 77 77.00000 0.0000000 2.877568 ## 22 S6066 AA 67 67.00000 0.0000000 2.638564 ## 23 S6068 BB 40 40.00000 0.0000000 2.100363 visualization plot_boxplot(data=dada_ps_rare_genus_alpha, y_index = c(&quot;Shannon&quot;, &quot;Chao1&quot;, &quot;Observed&quot;), group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;red&quot;, &quot;blue&quot;)) Figure 5.1: Alpha diversity (16s example) 5.2 Beta diversity beta dipersion dada2_ps_beta &lt;- run_beta_diversity(ps=dada2_ps_rare_genus, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.017526 0.0175257 2.7119 999 0.109 ## Residuals 21 0.135711 0.0064624 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.116 ## BB 0.11449 dada2_ps_beta$BetaDispersion Figure 5.2: Beta diversity (16s example) beta distance plot_distance_corrplot(dada2_ps_beta$BetaDistance) Figure 5.3: Beta distance 5.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 "],["permanova-beta-dispersion-ordination.html", "Chapter 6 PERMANOVA + beta dispersion + Ordination 6.1 PERMANOVA 6.2 beta dispersion 6.3 Ordination 6.4 Systematic Information", " Chapter 6 PERMANOVA + beta dispersion + Ordination Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) 6.1 PERMANOVA dada2_ps_per &lt;- run_permanova(ps=dada2_ps_rare_genus, method = &quot;bray&quot;, columns = &quot;Group&quot;) print(dada2_ps_per) ## SumsOfSample Df SumsOfSqs MeanSqs F.Model R2 Pr(&gt;F) AdjustedPvalue ## Group 23 1 0.2014665 0.2014665 1.132006 0.05114792 0.328 0.328 The PERMANOVA result of the Group (AdjustedPvalue &gt; 0.05) revealed that the two groups had not the distinct patterns of microbial community. 6.2 beta dispersion beta_df &lt;- run_beta_diversity(ps=dada2_ps_rare_genus, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.017526 0.0175257 2.7119 999 0.109 ## Residuals 21 0.135711 0.0064624 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## AA BB ## AA 0.116 ## BB 0.11449 6.3 Ordination We performed ordination by using Principal Coordinate Analysis (PCoA). If you want to try other methods please go to see Chapter 8 for more details. dada2_ps_ordination &lt;- run_ordination( ps = dada2_ps_rare_genus, group = &quot;Group&quot;, method = &quot;PCoA&quot;) plot_Ordination(ResultList = dada2_ps_ordination, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), group_color = c(&quot;blue&quot;, &quot;red&quot;)) Figure 6.1: PCoA (16s example) 6.4 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 "],["microbial-composition.html", "Chapter 7 Microbial composition 7.1 Stacked barplot 7.2 Core microbiota 7.3 Systematic Information", " Chapter 7 Microbial composition Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) A whole picture of the microbial composition. 7.1 Stacked barplot XVIZ package plot_stacked_bar_XIVZ( phyloseq = dada2_ps_rare, level = &quot;Phylum&quot;, feature = &quot;Group&quot;) Figure 7.1: Microbial composition (16s example) XVIZ XMAS package plot_StackBarPlot( ps=dada2_ps_rare, taxa_level=&quot;Phylum&quot;, group = &quot;Group&quot;, cluster = TRUE) Figure 7.2: Microbial composition (16s example) 7.2 Core microbiota convert absolute abundance into relative abundance dada2_ps_rare_rb &lt;- XMAS2::normalize(dada2_ps_rare, method = &quot;TSS&quot;) dada2_ps_rare_rb ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 891 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 891 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 891 tips and 888 internal nodes ] ## refseq() DNAStringSet: [ 891 reference sequences ] visualization prevalences &lt;- seq(0.05, 1, 0.05) detections &lt;- 10^seq(log10(1e-3), log10(0.2), length = 10) pl_core &lt;- plot_core_taxa(dada2_ps_rare_rb, plot.type = &quot;heatmap&quot;, colours = gray(seq(0, 1, length=5)), prevalences = prevalences, detections = detections, min.prevalence = 0.5)+ xlab(&quot;Detection Threshold (Relative Abundance (%))&quot;) pl_core Figure 7.3: Core taxa (16s example) The degree of color indicates the size of abundance and prevalence. Use core_members to obtain the core taxa. detection for abundance and prevalence for occurrence. core_taxa_name &lt;- core_members(dada2_ps_rare_rb, detection = 0.01, prevalence = 0.8) print(core_taxa_name) ## [1] &quot;ASV_1&quot; Result: Only 2 genera (g__Bifidobacterium and g__Blautia) passed the threshold of detection and prevalence which we choose. 7.3 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 Rhdf5lib_1.16.0 ## [41] shape_1.4.6 abind_1.4-5 scales_1.1.1 mvtnorm_1.1-3 DBI_1.1.2 ## [46] edgeR_3.36.0 rstatix_0.7.0 xtable_1.8-4 foreign_0.8-82 bit_4.0.4 ## [51] Formula_1.2-4 glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 ## [56] RColorBrewer_1.1-2 modeltools_0.2-23 ellipsis_0.3.2 pkgconfig_2.0.3 XML_3.99-0.9 ## [61] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [66] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [71] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [76] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [81] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [86] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [91] coin_1.4-2 nlme_3.1-155 compiler_4.1.2 rstudioapi_0.13 png_0.1-7 ## [96] ggsignif_0.6.3 geneplotter_1.72.0 bslib_0.3.1 stringi_1.7.6 highr_0.9 ## [101] lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 permute_0.9-7 multtest_2.50.0 ## [106] vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 rhdf5filters_1.6.0 jquerylib_0.1.4 ## [111] data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 latticeExtra_0.6-29 R6_2.5.1 ## [116] bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 codetools_0.2-18 MASS_7.3-55 ## [121] gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 rhdf5_2.38.1 DESeq2_1.34.0 ## [126] withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 mgcv_1.8-39 parallel_4.1.2 ## [131] rpart_4.1.16 tidyr_1.2.0 rmarkdown_2.13 carData_3.0-5 lubridate_1.8.0 ## [136] base64enc_0.1-3 "],["differential-analysis.html", "Chapter 8 Differential Analysis 8.1 Filtering and trimming 8.2 Liner discriminant analysis (LDA) effect size (LEfSe) 8.3 Wilcoxon Rank-Sum test 8.4 Dominant taxa 8.5 Multiple differential analysis by one function 8.6 Systematic Information", " Chapter 8 Differential Analysis Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) library(SummarizedExperiment) There are more than 10 approaches to perform differential analysis. Here, we choose two of them and recommend users going to XMAS2: Chapter 11 to see more details. 8.1 Filtering and trimming We suggest that filtering taxa with low abundance (the summarized value under cutoff: 10) and trimming taxa with low prevalence (default: 0.2). 8.1.1 Filtering the low relative abundance or unclassified taxa by the threshold (total counts &lt; 10) dada2_ps_rare_genus_filter &lt;- run_filter(dada2_ps_rare_genus, cutoff = 10, unclass = TRUE) dada2_ps_rare_genus_filter ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 149 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 149 taxa by 6 taxonomic ranks ] 8.1.2 Trimming the taxa with low occurrence less than threshold dada2_ps_rare_genus_filter_trim &lt;- run_trim(dada2_ps_rare_genus_filter, cutoff = 0.2, trim = &quot;feature&quot;) dada2_ps_rare_genus_filter_trim ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 100 taxa and 23 samples ] ## sample_data() Sample Data: [ 23 samples by 1 sample variables ] ## tax_table() Taxonomy Table: [ 100 taxa by 6 taxonomic ranks ] Finally, we obtained the final phyloseq-class object dada2_ps_rare_genus_filter_trim and changed its name. 8.2 Liner discriminant analysis (LDA) effect size (LEfSe) Calculation dada2_ps_lefse &lt;- run_lefse( dada2_ps_rare_genus_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), Lda = 2) head(dada2_ps_lefse) ## TaxaID Block Enrichment LDA_Score EffectSize Log2FoldChange (Median)\\nAA_vs_BB Median Abundance\\n(All) ## 1 g__Parasutterella 9_AA vs 14_BB AA -3.679337 1.668801 4.402050 172.77125 ## 2 g__Ruminococcaceae_UCG_004 9_AA vs 14_BB AA -2.467155 1.593295 NA 241.24923 ## 3 g__Odoribacter 9_AA vs 14_BB BB 2.720655 1.317365 NA 21.93175 ## 4 g__Romboutsia 9_AA vs 14_BB BB 3.750779 3.016968 -6.856424 2189.79596 ## 5 g__Lactobacillus 9_AA vs 14_BB BB 4.075009 2.628616 -3.336128 1283.85401 ## Median Abundance\\nAA Median Abundance\\nBB Log2FoldChange (Mean)\\nAA_vs_BB Mean Abundance\\n(All) Mean Abundance\\nAA Mean Abundance\\nBB ## 1 1080.35695 51.09966 4.481148 3901.0977 9320.3061 417.3209 ## 2 2451.90494 0.00000 2.342928 1443.2092 2822.7139 556.3847 ## 3 604.99989 0.00000 2.099583 578.0758 1083.9017 252.9020 ## 4 50.35627 5835.02623 -3.334490 7094.1306 1086.1419 10956.4090 ## 5 520.46061 5256.08763 -5.173067 19938.7655 892.0297 32183.0957 ## Occurrence (100%)\\n(All) Occurrence (100%)\\nAA Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 65.22 88.89 50.00 0.0025 (-12;12) ## 2 52.17 77.78 35.71 0.14 (-3.7;4) ## 3 52.17 77.78 35.71 0.31 (-2;2.6) ## 4 78.26 55.56 92.86 76 (85;68) ## 5 86.96 77.78 92.86 1.1e+08 (1.1e+08;1.1e+08) Visualization plot_lefse( da_res = dada2_ps_lefse, x_index = &quot;LDA_Score&quot;, x_index_cutoff = 2, group_color = c(&quot;green&quot;, &quot;red&quot;)) Figure 8.1: Lefse analysis (16s example) 8.3 Wilcoxon Rank-Sum test Calculation dada2_ps_wilcox &lt;- run_wilcox( dada2_ps_rare_genus_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;)) head(dada2_ps_wilcox) ## TaxaID Block Enrichment EffectSize Statistic Pvalue AdjustedPvalue Log2FoldChange (Median)\\nAA_vs_BB ## 1 g__Actinomyces 9_AA vs 14_BB Nonsignif 39.65079 44.5 0.2556616 0.7114368 -0.9577718 ## 2 g__Adlercreutzia 9_AA vs 14_BB Nonsignif 23.17460 44.0 0.1980169 0.7114368 NA ## 3 g__Agathobacter 9_AA vs 14_BB Nonsignif 1222.58730 71.0 0.6293971 0.9106171 0.1524904 ## 4 g__Alistipes 9_AA vs 14_BB Nonsignif 23.03175 67.0 0.8239942 0.9286981 -0.1085245 ## 5 g__Anaerostipes 9_AA vs 14_BB Nonsignif 60.25397 57.0 0.7343041 0.9167109 0.9551297 ## 6 g__Bacteroides 9_AA vs 14_BB Nonsignif 4064.23016 89.0 0.1093014 0.7114368 1.5367266 ## Median Abundance\\n(All) Median Abundance\\nAA Median Abundance\\nBB Log2FoldChange (Rank)\\nAA_vs_BB Mean Rank Abundance\\nAA ## 1 30 26 50.5 -0.42227633 9.94 ## 2 0 0 9.0 -0.43387758 9.89 ## 3 316 329 296.0 0.17342686 12.89 ## 4 64 64 69.0 0.08724541 12.44 ## 5 537 918 473.5 -0.13367844 11.33 ## 6 3807 9103 3137.5 0.55428610 14.89 ## Mean Rank Abundance\\nBB Occurrence (100%)\\n(All) Occurrence (100%)\\nAA Occurrence (100%)\\nBB Odds Ratio (95% CI) ## 1 13.32 82.61 88.89 78.57 4.1 (6.8;1.3) ## 2 13.36 43.48 33.33 50.00 8.6 (13;4.3) ## 3 11.43 65.22 55.56 71.43 0.39 (-1.4;2.2) ## 4 11.71 73.91 77.78 71.43 0.88 (0.64;1.1) ## 5 12.43 95.65 100.00 92.86 1.1 (1.2;0.93) ## 6 10.14 100.00 100.00 100.00 0.45 (-1.1;2) Volcano plot_volcano( dada2_ps_wilcox, group_names = c(&quot;AA&quot;, &quot;BB&quot;), x_index = &quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, group_color = c(&quot;red&quot;, &quot;grey&quot;, &quot;blue&quot;), topN = 5) Figure 8.2: Wilcoxon Rank-Sum test (16s example) 8.4 Dominant taxa Display the significant taxa with selection using boxplot. plot_topN_boxplot( ps = dada2_ps_rare_genus_filter_trim, da_res = dada2_ps_wilcox, x_index = &quot;Log2FoldChange (Rank)\\nAA_vs_BB&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, topN = 5, group = &quot;Group&quot;) Figure 8.3: Dominant Taxa 8.5 Multiple differential analysis by one function here, we provide the run_multiple_da for obtaining the results list from multiple differential analysis methods. multiple_res &lt;- run_multiple_da( dada2_ps_rare_genus_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;AA&quot;, &quot;BB&quot;), da_method = c(&quot;aldex&quot;, &quot;limma_voom&quot;, &quot;mbzinb&quot;, &quot;omnibus&quot;)) ## Start GMPR normalization ... ## Start Winsorization ... ## Perform filtering ... ## --A total of 68 taxa will be tested with a sample size of 23 ! ## --Omnibus test is selected! ## --Dispersion is treated as a parameter of interest! ## Start testing ... ## 10 % ## 20 % ## 30 % ## 40 % ## 50 % ## 60 % ## 70 % ## 80 % ## 90 % ## 100%! ## Handle failed taxa using permutation test! ## Permutation test .... ## Completed! names(multiple_res) ## [1] &quot;aldex&quot; &quot;limma_voom&quot; &quot;mbzinb&quot; &quot;omnibus&quot; plot results plot_multiple_DA( Multip_DA_res = multiple_res, x_index_list = c(&quot;EffectSize&quot;, &quot;logFC&quot;, &quot;mean.LFC&quot;, &quot;abund.LFC.CompvarBB.est&quot;), x_index_cutoff = 1, y_index = &quot;AdjustedPvalue&quot;, y_index_cutoff = 0.5, cellwidth = 50, cellheight = 15, fontsize_number = 15) Figure 8.4: Multiple DA results 8.6 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 RcppZiggurat_0.1.6 ## [41] Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 scales_1.1.1 ## [46] pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 rstatix_0.7.0 ## [51] xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 truncnorm_1.0-8 ## [56] glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 RColorBrewer_1.1-2 ## [61] modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 pkgconfig_2.0.3 XML_3.99-0.9 ## [66] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [71] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [76] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [81] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [86] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [91] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [96] coin_1.4-2 nlme_3.1-155 mbzinb_0.2 compiler_4.1.2 rstudioapi_0.13 ## [101] png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 geneplotter_1.72.0 bslib_0.3.1 ## [106] stringi_1.7.6 highr_0.9 lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 ## [111] permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 ## [116] rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 ## [121] latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 ## [126] codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 ## [131] rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 ## [136] mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 tidyr_1.2.0 Rfast_2.0.6 ## [141] rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 lubridate_1.8.0 base64enc_0.1-3 "],["test-example.html", "Chapter 9 Test Example 9.1 Loading packages 9.2 Loading data 9.3 Metaphlan2 result 9.4 Step1: Reads’ Track 9.5 Step2: Convert inputs into phyloseq data 9.6 Step3: BRS checking 9.7 Step4: Rarefaction curves 9.8 Step5: Rarefy otu counts 9.9 Step6: Extracting specific taxonomic level 9.10 Step7: GlobalView 9.11 Step8: Differential Analysis 9.12 Systematic Information", " Chapter 9 Test Example 9.1 Loading packages library(XMAS2) library(dplyr) library(tibble) library(phyloseq) library(ggplot2) library(ggpubr) library(SummarizedExperiment) library(readxl) 9.2 Loading data dada2_res &lt;- readRDS(&quot;DataSet/RawData/dada2_res.rds&quot;) tree &lt;- read_tree(&quot;DataSet/RawData/tree.nwk&quot;) metadata &lt;- read_xlsx(&quot;DataSet/RawData/诺禾宏基因组678月-ZH.xlsx&quot;, sheet = 3) metaphlan2_res &lt;- read.table(&quot;DataSet/RawData/merged_metaphlan2.tsv&quot;, header = TRUE, stringsAsFactors = FALSE) %&gt;% tibble::rownames_to_column(&quot;ID&quot;) 9.3 Metaphlan2 result metaphlan2_res_list &lt;- import_metaphlan_taxa(metaphlan2_res, taxa_level = &quot;Species&quot;) tax_tab &lt;- metaphlan2_res_list$tax_tab otu_tab &lt;- metaphlan2_res_list$abu_tab colnames(otu_tab) &lt;- gsub(&quot;X&quot;, &quot;S_&quot;, colnames(otu_tab)) sam_tab &lt;- metadata %&gt;% data.frame() %&gt;% dplyr::mutate(Group=ifelse(SampleType == &quot;粪便&quot;, &quot;Stool&quot;, ifelse(SampleType == &quot;QC&quot;, &quot;QC&quot;, &quot;Product&quot;))) %&gt;% dplyr::select(SampleTubeID, Group, everything()) rownames(sam_tab) &lt;- paste0(&quot;S_&quot;, sam_tab$SeqID_MGS) overlap_samples &lt;- intersect(rownames(sam_tab), colnames(otu_tab)) otu_tab_cln &lt;- otu_tab[, match(overlap_samples, colnames(otu_tab))] sam_tab_cln &lt;- sam_tab[match(overlap_samples, rownames(sam_tab)), ] rownames(sam_tab_cln) &lt;- overlap_samples metaphlan2_ps &lt;- get_metaphlan_phyloseq(otu_tab = otu_tab_cln, sam_tab = sam_tab_cln, tax_tab = tax_tab) metaphlan2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 328 taxa and 145 samples ] ## sample_data() Sample Data: [ 145 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 328 taxa by 7 taxonomic ranks ] 9.4 Step1: Reads’ Track plot_Dada2Track(data=dada2_res$reads_track) + guides(color=&quot;none&quot;) Figure 9.1: DADA2’ read track (Example) 9.5 Step2: Convert inputs into phyloseq data tax_tab_16s &lt;- import_dada2_taxa(dada2_res$tax_tab) otu_tab_16s &lt;- dada2_res$seq_tab # Shouldn&#39;t use the Total Number as SampleID (wrong: 123456; right: X123456) rownames(otu_tab_16s) &lt;- paste0(&quot;S_&quot;, rownames(otu_tab_16s)) sam_tab_16s &lt;- metadata %&gt;% data.frame() %&gt;% dplyr::mutate(Group=ifelse(SampleType == &quot;粪便&quot;, &quot;Stool&quot;, ifelse(SampleType == &quot;QC&quot;, &quot;QC&quot;, &quot;Product&quot;))) %&gt;% dplyr::filter(SampleTubeID %in% sam_tab_cln$SampleTubeID) %&gt;% dplyr::select(SampleTubeID, Group, everything()) rownames(sam_tab_16s) &lt;- paste0(&quot;S_&quot;, sam_tab_16s$SeqID_16s) overlap_samples_16s &lt;- intersect(rownames(sam_tab_16s), rownames(otu_tab_16s)) otu_tab_16s_cln &lt;- otu_tab_16s[match(overlap_samples_16s, rownames(otu_tab_16s)), ] sam_tab_16s_cln &lt;- sam_tab_16s[match(overlap_samples_16s, rownames(sam_tab_16s)), ] dada2_ps &lt;- get_dada2_phyloseq( seq_tab = otu_tab_16s_cln, tax_tab = tax_tab_16s, sam_tab = sam_tab_16s_cln, phy_tree = tree) dada2_ps ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 1948 taxa and 145 samples ] ## sample_data() Sample Data: [ 145 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 1948 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 1948 tips and 1933 internal nodes ] ## refseq() DNAStringSet: [ 1948 reference sequences ] if (!dir.exists(&quot;DataSet/Step2/&quot;)) { dir.create(&quot;DataSet/Step2/&quot;) } saveRDS(dada2_ps, &quot;DataSet/Step2/Donor_16s_phyloseq.RDS&quot;, compress = TRUE) 9.6 Step3: BRS checking dada2_ps &lt;- readRDS(&quot;DataSet/Step2/Donor_16s_phyloseq.RDS&quot;) dada2_ps_genus &lt;- summarize_taxa(dada2_ps, taxa_level = &quot;Genus&quot;) tail(dada2_ps_genus@sam_data %&gt;% data.frame()) ## SampleTubeID Group Date_Sequencing ProductID SampleType ProductBatch Date_Sampling Date_Receiving SeqID_MGS SeqID_16s ## S_7929 GGM50-210730 Stool 2021-08-03 M50 粪便 CYM50-210735 2021.07.30 2021-08-06 7769 7929 ## S_7930 CYM50-210735-0727 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.27 2021-08-06 7770 7930 ## S_7931 CYM50-210735-0728 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.28 2021-08-06 7771 7931 ## S_7932 CYM50-210735-0729 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.29 2021-08-06 7772 7932 ## S_7933 CYM50-210735-0730 Product 2021-08-03 M50 肠菌胶囊 CYM50-210735 2021.07.30 2021-08-06 7773 7933 ## S_7327 Community QC &lt;NA&gt; Ref QC &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; 7222 7327 ## Pipeline_MGS Pipeline_16s ## S_7929 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7930 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7931 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7932 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7933 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 ## S_7327 /share/work/HPC/work_tmp/PipelineJob_180_20210923/output /share/projects/Engineering/pipeline_output/PipelineJob_304_20211203 run_RefCheck( ps=dada2_ps_genus, BRS_ID=&quot;S_7327&quot;, Reference=NULL, Ref_type=&quot;16s&quot;, Save=NULL) ## 8002 8003 8004 8005 8006 8007 8008 8009 S_7327 mean ## Lactobacillus 2.61732573 3.36856272 3.44379163 3.88394343 5.92927 5.780008 5.781891 6.326723 12.263006 5.48828 ## Escherichia/Shigella 15.27581475 16.00265210 12.36527954 14.08077142 10.84235 13.432037 10.157432 11.599456 12.119942 12.87508 ## Enterococcus 14.51444842 14.66472707 11.04239952 11.66901114 13.16748 12.073609 12.887711 12.849247 7.258671 12.23637 ## Impurity_level 0.08562792 0.06531291 0.05987576 0.06228054 0.00000 0.000000 0.000000 0.000000 68.360000 7.62590 ## Evaluation ## Lactobacillus S_7327 didn&#39;t pass the threshold (2022-06-01 18:12:16). ## Escherichia/Shigella S_7327 didn&#39;t pass the threshold (2022-06-01 18:12:16). ## Enterococcus S_7327 didn&#39;t pass the threshold (2022-06-01 18:12:16). ## Impurity_level S_7327 didn&#39;t pass the threshold (2022-06-01 18:12:16). dada2_ps_remove_BRS &lt;- get_GroupPhyloseq( ps = dada2_ps, group = &quot;Group&quot;, group_names = &quot;QC&quot;) dada2_ps_remove_BRS ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 1948 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 1948 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 1948 tips and 1933 internal nodes ] ## refseq() DNAStringSet: [ 1948 reference sequences ] if (!dir.exists(&quot;DataSet/Step3/&quot;)) { dir.create(&quot;DataSet/Step3/&quot;) } saveRDS(dada2_ps_remove_BRS, &quot;DataSet/Step3/Donor_16s_phyloseq_remove_BRS.RDS&quot;, compress = TRUE) 9.7 Step4: Rarefaction curves dada2_ps_remove_BRS &lt;- readRDS(&quot;DataSet/Step3/Donor_16s_phyloseq_remove_BRS.RDS&quot;) plot_RarefCurve(ps = dada2_ps_remove_BRS, taxa_level = &quot;OTU&quot;, step = 100, label = &quot;Group&quot;, color = &quot;Group&quot;) ## rarefying sample S_7271 ## rarefying sample S_7272 ## rarefying sample S_7273 ## rarefying sample S_7274 ## rarefying sample S_7275 ## rarefying sample S_7276 ## rarefying sample S_7277 ## rarefying sample S_7278 ## rarefying sample S_7279 ## rarefying sample S_7280 ## rarefying sample S_7281 ## rarefying sample S_7282 ## rarefying sample S_7283 ## rarefying sample S_7284 ## rarefying sample S_7285 ## rarefying sample S_7286 ## rarefying sample S_7287 ## rarefying sample S_7288 ## rarefying sample S_7289 ## rarefying sample S_7290 ## rarefying sample S_7291 ## rarefying sample S_7292 ## rarefying sample S_7293 ## rarefying sample S_7294 ## rarefying sample S_7295 ## rarefying sample S_7296 ## rarefying sample S_7297 ## rarefying sample S_7298 ## rarefying sample S_7299 ## rarefying sample S_7300 ## rarefying sample S_7301 ## rarefying sample S_7302 ## rarefying sample S_7303 ## rarefying sample S_7304 ## rarefying sample S_7305 ## rarefying sample S_7306 ## rarefying sample S_7307 ## rarefying sample S_7308 ## rarefying sample S_7309 ## rarefying sample S_7310 ## rarefying sample S_7311 ## rarefying sample S_7312 ## rarefying sample S_7313 ## rarefying sample S_7314 ## rarefying sample S_7315 ## rarefying sample S_7316 ## rarefying sample S_7317 ## rarefying sample S_7318 ## rarefying sample S_7319 ## rarefying sample S_7320 ## rarefying sample S_7321 ## rarefying sample S_7322 ## rarefying sample S_7323 ## rarefying sample S_7324 ## rarefying sample S_7325 ## rarefying sample S_7326 ## rarefying sample S_7846 ## rarefying sample S_7847 ## rarefying sample S_7848 ## rarefying sample S_7849 ## rarefying sample S_7850 ## rarefying sample S_7851 ## rarefying sample S_7852 ## rarefying sample S_7853 ## rarefying sample S_7854 ## rarefying sample S_7855 ## rarefying sample S_7856 ## rarefying sample S_7857 ## rarefying sample S_7858 ## rarefying sample S_7859 ## rarefying sample S_7860 ## rarefying sample S_7861 ## rarefying sample S_7862 ## rarefying sample S_7863 ## rarefying sample S_7864 ## rarefying sample S_7865 ## rarefying sample S_7866 ## rarefying sample S_7867 ## rarefying sample S_7868 ## rarefying sample S_7869 ## rarefying sample S_7870 ## rarefying sample S_7871 ## rarefying sample S_7872 ## rarefying sample S_7873 ## rarefying sample S_7874 ## rarefying sample S_7875 ## rarefying sample S_7876 ## rarefying sample S_7877 ## rarefying sample S_7878 ## rarefying sample S_7879 ## rarefying sample S_7880 ## rarefying sample S_7881 ## rarefying sample S_7882 ## rarefying sample S_7883 ## rarefying sample S_7884 ## rarefying sample S_7885 ## rarefying sample S_7886 ## rarefying sample S_7887 ## rarefying sample S_7888 ## rarefying sample S_7889 ## rarefying sample S_7890 ## rarefying sample S_7891 ## rarefying sample S_7892 ## rarefying sample S_7893 ## rarefying sample S_7894 ## rarefying sample S_7895 ## rarefying sample S_7896 ## rarefying sample S_7897 ## rarefying sample S_7898 ## rarefying sample S_7899 ## rarefying sample S_7900 ## rarefying sample S_7901 ## rarefying sample S_7902 ## rarefying sample S_7903 ## rarefying sample S_7904 ## rarefying sample S_7905 ## rarefying sample S_7906 ## rarefying sample S_7907 ## rarefying sample S_7908 ## rarefying sample S_7909 ## rarefying sample S_7910 ## rarefying sample S_7911 ## rarefying sample S_7912 ## rarefying sample S_7913 ## rarefying sample S_7914 ## rarefying sample S_7915 ## rarefying sample S_7916 ## rarefying sample S_7917 ## rarefying sample S_7918 ## rarefying sample S_7919 ## rarefying sample S_7920 ## rarefying sample S_7921 ## rarefying sample S_7922 ## rarefying sample S_7923 ## rarefying sample S_7924 ## rarefying sample S_7925 ## rarefying sample S_7926 ## rarefying sample S_7927 ## rarefying sample S_7928 ## rarefying sample S_7929 ## rarefying sample S_7930 ## rarefying sample S_7931 ## rarefying sample S_7932 ## rarefying sample S_7933 Figure 9.2: Rarefaction curves (Example) 9.8 Step5: Rarefy otu counts dada2_ps_remove_BRS &lt;- readRDS(&quot;DataSet/Step3/Donor_16s_phyloseq_remove_BRS.RDS&quot;) summarize_phyloseq(dada2_ps_remove_BRS) ## [[1]] ## [1] &quot;1] Min. number of reads = 33267&quot; ## ## [[2]] ## [1] &quot;2] Max. number of reads = 153367&quot; ## ## [[3]] ## [1] &quot;3] Total number of reads = 10909876&quot; ## ## [[4]] ## [1] &quot;4] Average number of reads = 75763.0277777778&quot; ## ## [[5]] ## [1] &quot;5] Median number of reads = 71985.5&quot; ## ## [[6]] ## [1] &quot;7] Sparsity = 0.912599104494638&quot; ## ## [[7]] ## [1] &quot;6] Any OTU sum to 1 or less? YES&quot; ## ## [[8]] ## [1] &quot;8] Number of singletons = 837&quot; ## ## [[9]] ## [1] &quot;9] Percent of OTUs that are singletons\\n (i.e. exactly one read detected across all samples)0&quot; ## ## [[10]] ## [1] &quot;10] Number of sample variables are: 12&quot; ## ## [[11]] ## [1] &quot;SampleTubeID&quot; &quot;Group&quot; &quot;Date_Sequencing&quot; &quot;ProductID&quot; &quot;SampleType&quot; &quot;ProductBatch&quot; &quot;Date_Sampling&quot; ## [8] &quot;Date_Receiving&quot; &quot;SeqID_MGS&quot; &quot;SeqID_16s&quot; &quot;Pipeline_MGS&quot; &quot;Pipeline_16s&quot; dada2_ps_rare &lt;- norm_rarefy(dada2_ps_remove_BRS, size = 33267, rng_seed = 123) dada2_ps_rare ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 1091 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 1091 taxa by 7 taxonomic ranks ] ## phy_tree() Phylogenetic Tree: [ 1091 tips and 1086 internal nodes ] ## refseq() DNAStringSet: [ 1091 reference sequences ] if (!dir.exists(&quot;DataSet/Step5/&quot;)) { dir.create(&quot;DataSet/Step5/&quot;) } saveRDS(dada2_ps_rare, &quot;DataSet/Step5/Donor_16s_phyloseq_remove_BRS_rare.RDS&quot;, compress = TRUE) 9.9 Step6: Extracting specific taxonomic level dada2_ps_rare &lt;- readRDS(&quot;DataSet/Step5/Donor_16s_phyloseq_remove_BRS_rare.RDS&quot;) dada2_ps_rare_genus &lt;- summarize_taxa(dada2_ps_rare, taxa_level = &quot;Genus&quot;) dada2_ps_rare_genus ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 225 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 225 taxa by 6 taxonomic ranks ] dada2_ps_rare_order &lt;- summarize_taxa(dada2_ps_rare, taxa_level = &quot;Order&quot;) dada2_ps_rare_order ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 37 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 37 taxa by 4 taxonomic ranks ] dada2_ps_rare_phylum &lt;- summarize_taxa(dada2_ps_rare, taxa_level = &quot;Phylum&quot;) dada2_ps_rare_phylum ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 15 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 15 taxa by 2 taxonomic ranks ] if (!dir.exists(&quot;DataSet/Step6/&quot;)) { dir.create(&quot;DataSet/Step6/&quot;) } saveRDS(dada2_ps_rare_genus, &quot;DataSet/Step6/Donor_16s_phyloseq_remove_BRS_rare_genus.RDS&quot;, compress = TRUE) saveRDS(dada2_ps_rare_order, &quot;DataSet/Step6/Donor_16s_phyloseq_remove_BRS_rare_order.RDS&quot;, compress = TRUE) saveRDS(dada2_ps_rare_phylum, &quot;DataSet/Step6/Donor_16s_phyloseq_remove_BRS_rare_phylum.RDS&quot;, compress = TRUE) 9.10 Step7: GlobalView dada2_ps_rare_genus &lt;- readRDS(&quot;DataSet/Step6/Donor_16s_phyloseq_remove_BRS_rare_genus.RDS&quot;) # alpha dada2_ps_rare_genus_alpha &lt;- run_alpha_diversity(ps=dada2_ps_rare_genus, measures = c(&quot;Shannon&quot;, &quot;Chao1&quot;, &quot;Observed&quot;)) plot_boxplot(data=dada2_ps_rare_genus_alpha, y_index = c(&quot;Shannon&quot;, &quot;Chao1&quot;, &quot;Observed&quot;), group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), group_color = c(&quot;red&quot;, &quot;blue&quot;)) Figure 9.3: diversity and ordination and composition(Example) # beta dada2_ps_beta &lt;- run_beta_diversity(ps=dada2_ps_rare_genus, method = &quot;bray&quot;) plot_distance_corrplot(dada2_ps_beta$BetaDistance) Figure 9.4: diversity and ordination and composition(Example) # permanova dada2_ps_per &lt;- run_permanova(ps=dada2_ps_rare_genus, method = &quot;bray&quot;, columns = &quot;Group&quot;) print(dada2_ps_per) ## SumsOfSample Df SumsOfSqs MeanSqs F.Model R2 Pr(&gt;F) AdjustedPvalue ## Group 144 1 1.335187 1.335187 9.669403 0.06375315 0.001 0.001 # beta dispersion beta_df &lt;- run_beta_diversity(ps=dada2_ps_rare_genus, method = &quot;bray&quot;, group = &quot;Group&quot;) ## ## Permutation test for homogeneity of multivariate dispersions ## Permutation: free ## Number of permutations: 999 ## ## Response: Distances ## Df Sum Sq Mean Sq F N.Perm Pr(&gt;F) ## Groups 1 0.04375 0.043749 5.6785 999 0.016 * ## Residuals 142 1.09402 0.007704 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Pairwise comparisons: ## (Observed p-value below diagonal, permuted p-value above diagonal) ## Product Stool ## Product 0.017 ## Stool 0.018497 # ordination dada2_ps_ordination &lt;- run_ordination( ps = dada2_ps_rare_genus, group = &quot;Group&quot;, method = &quot;PCoA&quot;) plot_Ordination(ResultList = dada2_ps_ordination, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), group_color = c(&quot;blue&quot;, &quot;red&quot;)) Figure 9.5: diversity and ordination and composition(Example) # Microbial composition plot_stacked_bar_XIVZ( phyloseq = dada2_ps_rare_genus, level = &quot;Phylum&quot;, feature = &quot;Group&quot;) Figure 9.6: diversity and ordination and composition(Example) 9.11 Step8: Differential Analysis dada2_ps_rare_genus &lt;- readRDS(&quot;DataSet/Step6/Donor_16s_phyloseq_remove_BRS_rare_genus.RDS&quot;) # filter &amp; trim dada2_ps_rare_genus_filter &lt;- run_filter(dada2_ps_rare_genus, cutoff = 10, unclass = TRUE) dada2_ps_rare_genus_filter_trim &lt;- run_trim(dada2_ps_rare_genus_filter, cutoff = 0.2, trim = &quot;feature&quot;) dada2_ps_rare_genus_filter_trim ## phyloseq-class experiment-level object ## otu_table() OTU Table: [ 108 taxa and 144 samples ] ## sample_data() Sample Data: [ 144 samples by 12 sample variables ] ## tax_table() Taxonomy Table: [ 108 taxa by 6 taxonomic ranks ] # lefse dada2_ps_lefse &lt;- run_lefse( dada2_ps_rare_genus_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), Lda = 2) plot_lefse( da_res = dada2_ps_lefse, x_index = &quot;LDA_Score&quot;, x_index_cutoff = 2, group_color = c(&quot;green&quot;, &quot;red&quot;)) Figure 9.7: Differential Analysis (Example) dada2_ps_wilcox &lt;- run_wilcox( dada2_ps_rare_genus_filter_trim, group = &quot;Group&quot;, group_names = c(&quot;Stool&quot;, &quot;Product&quot;)) plot_volcano( dada2_ps_wilcox, group_names = c(&quot;Stool&quot;, &quot;Product&quot;), x_index = &quot;Log2FoldChange (Rank)\\nStool_vs_Product&quot;, x_index_cutoff = 0.5, y_index = &quot;Pvalue&quot;, y_index_cutoff = 0.05, group_color = c(&quot;red&quot;, &quot;grey&quot;, &quot;blue&quot;), topN = 5) Figure 9.8: Differential Analysis (Example) if (!dir.exists(&quot;DataSet/Step8/&quot;)) { dir.create(&quot;DataSet/Step8/&quot;) } saveRDS(dada2_ps_rare_genus_filter_trim, &quot;DataSet/Step8/Donor_16s_phyloseq_remove_BRS_rare_genus_filter_trim.RDS&quot;, compress = TRUE) 9.12 Systematic Information sessionInfo() ## R version 4.1.2 (2021-11-01) ## Platform: x86_64-apple-darwin17.0 (64-bit) ## Running under: macOS Monterey 12.2.1 ## ## Matrix products: default ## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib ## ## locale: ## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8 ## ## attached base packages: ## [1] grid stats4 stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] magrittr_2.0.2 glue_1.6.2 Gmisc_3.0.0 htmlTable_2.4.0 ## [5] Rcpp_1.0.8.2 readxl_1.4.0 SummarizedExperiment_1.24.0 Biobase_2.54.0 ## [9] GenomicRanges_1.46.1 GenomeInfoDb_1.30.1 IRanges_2.28.0 S4Vectors_0.32.3 ## [13] BiocGenerics_0.40.0 MatrixGenerics_1.6.0 matrixStats_0.61.0 ggpubr_0.4.0 ## [17] ggplot2_3.3.5 phyloseq_1.38.0 tibble_3.1.6 dplyr_1.0.8 ## [21] XMAS2_2.1.3 ## ## loaded via a namespace (and not attached): ## [1] backports_1.4.1 Hmisc_4.6-0 corrplot_0.92 plyr_1.8.6 igraph_1.2.11 ## [6] splines_4.1.2 BiocParallel_1.28.3 TH.data_1.1-0 digest_0.6.29 foreach_1.5.2 ## [11] htmltools_0.5.2 fansi_1.0.2 checkmate_2.0.0 memoise_2.0.1 cluster_2.1.2 ## [16] limma_3.50.1 Biostrings_2.62.0 annotate_1.72.0 sandwich_3.0-1 metagenomeSeq_1.36.0 ## [21] jpeg_0.1-9 colorspace_2.0-3 blob_1.2.2 ggrepel_0.9.1 xfun_0.30 ## [26] crayon_1.5.0 RCurl_1.98-1.6 jsonlite_1.8.0 libcoin_1.0-9 genefilter_1.76.0 ## [31] survival_3.3-1 zoo_1.8-9 iterators_1.0.14 ape_5.6-2 gtable_0.3.0 ## [36] zlibbioc_1.40.0 XVector_0.34.0 DelayedArray_0.20.0 car_3.0-12 RcppZiggurat_0.1.6 ## [41] Rhdf5lib_1.16.0 shape_1.4.6 pscl_1.5.5 abind_1.4-5 scales_1.1.1 ## [46] pheatmap_1.0.12 mvtnorm_1.1-3 DBI_1.1.2 edgeR_3.36.0 rstatix_0.7.0 ## [51] xtable_1.8-4 foreign_0.8-82 bit_4.0.4 Formula_1.2-4 truncnorm_1.0-8 ## [56] glmnet_4.1-3 htmlwidgets_1.5.4 httr_1.4.2 gplots_3.1.1 RColorBrewer_1.1-2 ## [61] modeltools_0.2-23 ellipsis_0.3.2 NADA_1.6-1.1 pkgconfig_2.0.3 XML_3.99-0.9 ## [66] farver_2.1.0 nnet_7.3-17 sass_0.4.0 locfit_1.5-9.5 utf8_1.2.2 ## [71] tidyselect_1.1.2 labeling_0.4.2 rlang_1.0.2 reshape2_1.4.4 AnnotationDbi_1.56.2 ## [76] munsell_0.5.0 cellranger_1.1.0 tools_4.1.2 cachem_1.0.6 cli_3.2.0 ## [81] generics_0.1.2 RSQLite_2.2.10 ade4_1.7-18 broom_0.7.12 evaluate_0.15 ## [86] biomformat_1.22.0 stringr_1.4.0 fastmap_1.1.0 yaml_2.3.5 knitr_1.37 ## [91] bit64_4.0.5 caTools_1.18.2 forestplot_2.0.1 purrr_0.3.4 KEGGREST_1.34.0 ## [96] coin_1.4-2 nlme_3.1-155 mbzinb_0.2 compiler_4.1.2 rstudioapi_0.13 ## [101] png_0.1-7 ggsignif_0.6.3 zCompositions_1.4.0 geneplotter_1.72.0 bslib_0.3.1 ## [106] stringi_1.7.6 highr_0.9 lattice_0.20-45 Matrix_1.4-0 vegan_2.5-7 ## [111] permute_0.9-7 multtest_2.50.0 vctrs_0.3.8 pillar_1.7.0 lifecycle_1.0.1 ## [116] rhdf5filters_1.6.0 jquerylib_0.1.4 data.table_1.14.2 cowplot_1.1.1 bitops_1.0-7 ## [121] latticeExtra_0.6-29 R6_2.5.1 bookdown_0.24 gridExtra_2.3 KernSmooth_2.23-20 ## [126] codetools_0.2-18 MASS_7.3-55 gtools_3.9.2 assertthat_0.2.1 Wrench_1.12.0 ## [131] rhdf5_2.38.1 DESeq2_1.34.0 withr_2.5.0 multcomp_1.4-18 GenomeInfoDbData_1.2.7 ## [136] mgcv_1.8-39 parallel_4.1.2 rpart_4.1.16 tidyr_1.2.0 Rfast_2.0.6 ## [141] rmarkdown_2.13 carData_3.0-5 ALDEx2_1.26.0 lubridate_1.8.0 base64enc_0.1-3 "],["references.html", "References", " References "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
